// Tactics: Initial Access / Execution (T1566 / T1059)
// Description: Detects when Microsoft Office applications spawn a command-line interpreter. 
// This is a high-fidelity indicator of a malicious macro or "one-click" phishing attachment.
#event_simpleName=ProcessRollup2

// Look for Office Apps as the Parent
| ParentBaseFileName=/^(winword|excel|powerpnt|outlook)\.exe$/i

// Look for a Shell or Scripting Interpreter being launched as the Child
| FileName=/^(powershell|cmd|wscript|cscript|mshta|sh|bash)\.exe$/i

// --- TUNING ---
// Exclude legitimate Excel-to-Cmd add-ins if your finance team uses them
// | CommandLine!=/.*(Known_Safe_Addin).*/i

| select([@timestamp, ComputerName, UserName, ParentBaseFileName, FileName, CommandLine])
| sort(@timestamp, order=desc)
